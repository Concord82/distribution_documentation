# Описание манифест файла воркспейса Optimacros

Для работы воркспейса Optimacros, используется манифест файл в формате JSON, 
который описывает основный настройки воркспейса требуемые для его работы.

Манифест воркспейса может иметь любое имя, по умолчанию используется имя `manifest.json`.

Расположение манифеста определяет директорию, которая содержит файловую 
подсистему для работы воркспейса в Linux контейнере.

## Пример базового варианта манифест файла

```
{
  "container": {
    "ip": "10.0.3.15",
    "cpu": 6,
    "memory": 33685016576,
    "ports": {},
    "hosts": {},
  },
  "workspace": {
    "id": "8522aedecc6b4219ee87ee28",
    "name": "TEST",
    "web": {
      "url": "https://om.test.workspace.ru" // <= Интересующее нас поле в случае смены адреса Логин центра
    },
    "loginCenter": {
      "url": "https://lc.company.ru/",
      "token": "4aed337a0ac34dd13716c476a4c7",
      "apiUrl": "wss://lc.company.ru/api/ws/v1/"
    },
    "admin": {
      "email": "admin@optimacros.com"
    }
  }
}
```

## Блок `container`

Блок `container` позволяет настроить работу Linux контейнера.

```
{
    "ip": "10.0.3.15",
    "cpu": 6,
    "memory": 33685016576,
    "ports": {},
    "hosts": {},
}
```

### IPv4 адрес контейнера

`required|string`

Для работы Linux контейнера используется LXC подсеть 10.0.3.0/24, 
которая автоматически назначает IPv4 адрес контейнеру. 
Для эмуляции статической привязки адреса, при поднятии контейнера 
мы дополнительно привязываем IPv4 адрес, выбор которого за вами.

Обычно мы выбираем адреса начиная с 10.0.3.15, 
а LXC обычно назначает автоматически контейнерам адреса начиная с 10.0.3.100.

```
{
    "ip": "10.0.3.15",
    ...
}
```

### CPU

`required|integer`

Ограничивает количество воркеров служб Optimacros.\
Не ограничивает память Linux контейнера.

Обычно указываем количество ядер хост сервера.

```
{
    ...
    "cpu": 6,
    ...
}
```

### Memory

`required|integer`

Память в байтах.\
Используется для некоторых ограничений служб Optimacros.\
Используется для формирования счетчика памяти Optimacros расположенного на Drive Landing.\
Не используется для ограничения Linux контейнера.

При работе одного воркспейса на сервере, обычно указывается значение из вывода команды `free -b`.\
При работе нескольких воркспейсов, указывается в нужных пропорциях между всеми воркспейсами

```
{
    ...
    "memory": 33685016576,
    ...
}
```

### Ports

`object`

Параметр позволяет настроить переадресацию портов. При этом можно гибко указать конкретный адрес интерфейса хоста.

При использовании воркспейса с логин центром на одном хосте, обычно мы не используем переадресацию 
портов на воркспейсе контейнере, так как используется Nginx логин центра в качестве reverse proxy.

Обычно переадресация портов воркспейса используем при установке воркспейса отдельно от логин центра.

Для внешнего взаимодействия с воркспейсом импользуются порты: 80, 443, 8080, 8081.

```
{
    ...
    "ports": {
        "0.0.0.0:80": 80,
        "0.0.0.0:443": 443,
        "0.0.0.0:8080": 8080,
        "0.0.0.0:8081": 8081
    },
    ...
}
```

Для работы на конкртеном интерфейсе, замените `0.0.0.0` на соответствующий ipv4 адрес.

Для переадресации портов должна быть установлена утилита [redir](https://github.com/troglobit/redir)

### Hosts

Параметр позволяет настроить файл контейнера `/etc/hosts` ([man](https://man7.org/linux/man-pages/man5/hosts.5.html))

```
{
    ...
    "hosts": {
        "test.example.com": "10.0.5.34",
        "ftp.example.com": "192.168.1.44"
    },
    ...
}
```

### DNS

`object`

Параметр позволяет настроить DNS для контейнера, файл 
`/etc/resolv.conf` ([man](https://man7.org/linux/man-pages/man5/resolv.conf.5.html)).

`dns.search` - `string[]` См. в `man` пункт о `search`.

`dns.nameServers` - `object[]` Каждый объект 
коллекции содержит информацию об одном DNS сервере

`dns.nameServers[n].ip` - `required|string` IpV4 адрес DNS сервера

```
{
    ...
    "dns": {
        "search": [
            "example.com"
        ],
        "nameServers": [
            {
                "ip": "8.8.8.8"
            },
            {
                "ip": "8.8.4.4"
            }
        ]
    },
    ...
}
```

Можно использовать `dnsmasq` ([man](https://wikipedia.org/wiki/Dnsmasq)) на хосте:

```
{
    ...
    "dns": {
        "nameServers": [
            {
                "ip": "10.0.3.1"
            }
        ]
    },
    ...
}
```

### Routes

Данный парамтер позволяет кастомизировать таблицу маршрутов 
контейнера ([man](https://man7.org/linux/man-pages/man8/ip-route.8.html))

```
{
    ...
    "routes": [
        {
            "destination": "192.168.1.50/32",
            "gateway": "10.0.3.1"
        }
    ],
    ...
}
```

### FreeTDS

## Блок workspace

### Id
### Name
### Web
### Login Center
### Admin
### Shared Folders
### Flags