# Чистая установка Логин Центра на клиентский сервер:

Подключаемся к серверу через ssh протокол.

Переходим в аккаунт root с помощью команды `sudo su`

![](./pictures/sshConnect.png)

Затем скачиваем дистрибутив логин центра через терминал с помощью команды: 

`wget https://nextcloud.optimacros.com/s/iRtXDicQGye4RHG/download -O ИМЯ_ФАЙЛА.С_РАСШИРЕНИЕМ`

![](./pictures/wget.png)

В случае, если на сервере уже установлен воркспейс, то необходимо завершить его работу. Предварительно открыв файл 
manifest.json, чтобы убедиться, что мы находимся на нужном сервере. Переходим в директории с файлом, как правило, это:
`/om/workspace1` и выполняем команду `cat manifest.json`

После того как мы удостоверились что находимся на нужном сервере (TEST или PROD). Завершаем работу воркспейса.

![](./pictures/shutdown.png)

Далее нам необходимо установить на сервере docker. Устанавливаем его, следуя инструкции из его официального сайта:

https://docs.docker.com/engine/install/ubuntu/

Далее мы создаём директорию на сервере под логин центр по пути: `/om/login-center`

Для этого переходим в папку om с помощью команды: `cd /om/` и создаём там директорию login-center с помощью команды
`mkdir login-center`

![](./pictures/mkdirLoginCenter.png)

Теперь когда мы подготовили папку для установки логин центра и скачали дистрибутив, нам необходимо будет установить его 
в созданную папку. Для этого переходим в директорию со скачанным ранее дистрибутивом с помощью команды `cd /home/имяПользователя/`. 
Выдаём файлу права с помощью команды `chmod +x login-center-версия.sh` и запускаем инсталлятор с помощью команды 
 `./login-center-версия.sh` во время установки инсталлятор попросит подтвердить установку логин центра в дефолтную 
 директорию по пути, которому мы как раз и подготовили директории. Текущая версия инсталлятора устанавливает логин центр с
  дефолтными настройками подключения, которые нам предстоит настроить вручную, далее нынешняя версия инсталлятора, выдаёт 
  ошибку со следующим содержимым:
 
![](./pictures/errorInstaller.png)

Которая нам говорит о том, что по заданным путям отсутствуют файлы сертификатов. Затем мы переходим в директорию, где 
лежит логин центр `cd /om/login-center`

![](./pictures/goToDirectoryAfterError.png)

Затем мы смотрим содержимое файла .env с помощью команды `cat .env` и видим что там есть только одно свойство VERSION.
 
Посмотрим какие контейнеры нам уже удалось установить, в результате первой попытки установки логин центра, воспользуемся командой: 
`docker ps -a`

![](./pictures/dockerPsA.png )

И посмотреть директорию data `ls -la data`

![](./pictures/lsLaData.png)

Видим что логин центр прервал установку на самом начальном этапе, до установки базы данных. Теперь мы можем смело 
редактировать .env файл, в соответствии с нашими требованиями. В частности установить пароли к аккаунту админа, пароли к базе 
данных и информацию о web части. 

![](./pictures/settingsEnv.png)

```
VERSION=1.1.9
HOSTNAME=profile.optimacros.com
DB_USERNAME=login-center
DB_PASSWORD=
GRAYLOG_PASSWORD=
GRAYLOG_PASSWORD_SHA2=
ADMIN_USERNAME=admin@optimacros.com
ADMIN_PASSWORD=
WORKSPACE_NAME=workspace1
WORKSPACE_HOSTNAME=workspace1.optimacros.com
```

Для пароля базы данных (DB_PASSWORD) воспользуемся любым генератором паролей в интернете (http://www.onlinepasswordgenerator.ru/), сгенерировав надёжный пароль длиной более 
20 символов. Для инструмента graylog так же генерируем пароль(GRAYLOG_PASSWORD), а затем генерируем к нему sha хэш пароль (GRAYLOG_PASSWORD_SHA2), воспользовавшись 
сервисом: http://emn178.github.io/online-tools/sha256.html. После настройки всех пунктов, сохраняем наши изменения в 
.env файл.

Затем вовращаемся к нашей проблеме во время установки логин центра. Переходим в папку с сертификатами с помощью команды
`cd /om/login-center/data/nginx/cert` После чего, находясь в папке для сертификатов, мы генерируем сами сертификаты 
с помощью команды 

`openssl req -newkey rsa:2048 -nodes -keyout crt.key -x509 -days 1095 -out bundle.crt`

Отвечаем на вопросы, которые задаст программа генерации. На этом с генерацией сертификатов мы заканчиваем.

Затем мы переходим снова в папку с инсталлятором логин центра с помощью команды: `cd /home/user/` и запускаем инсталлятор 
`./login-center-версия.sh` 

Во время установки на вопрос, нужно ли перезаписывать env файл конечно же отвечаем нет. Ожидаем процесс установки.

![](./pictures/installationLC.png)

Затем увидим вот такую консоль, это значит что логин центр успешно установлен.

![](./pictures/installComplete.png)



[Вернуться к содержанию <](contents.md)

[Вернуться к оглавлению <<](index.md)