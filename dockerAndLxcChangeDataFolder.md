# Как изменить директорию с данными для Docker и LXC

Системы контейнеризации Docker и LXC являются основой для работы Optimacros.

Для более безопасного использования Optimacros, советуем их директории выносить из раздела root (`/`)

## Docker

По умолчанию директория для Docker `/var/lib/docker`
В данной директории хранятся все контейнеры, тома и образы

Для изменения этой директории есть разные варианты, 
больше информации можно получить в интернете, мы взяли по нашему мнению наиболее правильное решение

Наш вариант проверен на Ubuntu 18.04 и ALT Server 9

`! Останавливаем все запущенные контейнеры`

Останавливаем сервис
```
systemctl stop docker
```

Копируем директорию
```
rsync -aqxP /var/lib/docker /opt1/docker
```

Временно архивируем оригинальную директорию
```
mv /var/lib/docker /var/lib/docker.old
```

Открываем файл с глобальными настройками сервиса
```
nano /etc/docker/daemon.json
```

И добавляем к остальным параметрам, параметр `data-root` с значением новой директории
```
{
        "data-root": "/opt1/docker"
}
```

Запускаем сервис
```
systemctl start docker
```

Проверяем результат
```
docker info | grep Root
```

Запускаем нужные существующие контейнеры, если все нормально, можно удалить архивную папку
```
rm -rf /var/lib/docker.old
```

## LXC

По умолчанию директория для LXC `/var/lib/lxc`

В данной директории хранятся все контейнеры

Для изменения этой директории есть разные варианты, больше информации можно получить в интернете, мы взяли по нашему мнению наиболее правильное решение

Наш вариант проверен на Ubuntu 18.04 и ALT Server 9

`! Останавливаем все запущенные контейнеры`

Останавливаем сервис
```
systemctl stop lxc
```

Переносим директорию
```
rsync -aqxP /var/lib/lxc /opt1/lxc
```

Временно архивируем оригинальную директорию
```
mv /var/lib/lxc /var/lib/lxc.old
```

Редктируем файл с конфигурацией, он может отсутствовать, тогда создаем его
```
nano /etc/lxc/lxc.conf
```

Добавляем параметр с новой директорией
```
lxc.lxcpath = /opt1/lxc
```

Запускаем сервис
```
systemctl start lxc
```

Запускаем нужные существующие контейнеры, если все нормально, можно удалить архивную папку
```
rm -rf /var/lib/lxc.old
```